"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.HeightAdapter = void 0;
const resize_observer_polyfill_1 = __importDefault(require("resize-observer-polyfill"));
/**
 * Service class to send height information of the plug-in to COYO.
 */
class HeightAdapter {
    /**
     * Creates a new instance of this class.
     *
     * @param srcId the plug-in source ID to use for requests
     * @returns the new instance
     */
    constructor(srcId) {
        this.srcId = srcId;
        this.observer = null;
    }
    /**
     * Connects this adapter to the HTML element that matches the given selectors,
     * observes its height and sends throttled update messages to COYO.
     *
     * @param selectors the selectors to target the HTML element
     * @param throttle a small timeframe to throttle messages
     */
    connect(selectors, throttle) {
        this.disconnect();
        this.observer = new resize_observer_polyfill_1.default(this.throttle((entries) => {
            const height = entries[0].contentRect.height;
            parent.postMessage({ iss: this.srcId, sub: HeightAdapter.RES_SUBJECT, height }, '*');
        }, throttle));
        const elem = document.querySelector(selectors);
        if (elem) {
            this.observer.observe(elem);
        }
    }
    /**
     * Disconnects this adapter from all HTML elements.
     */
    disconnect() {
        if (this.observer) {
            this.observer.disconnect();
            this.observer = null;
        }
    }
    throttle(cb, wait) {
        let timeout = null;
        return (entries, observer) => {
            if (timeout === null) {
                cb(entries, observer);
                timeout = window.setTimeout(() => (timeout = null), wait);
            }
        };
    }
}
exports.HeightAdapter = HeightAdapter;
HeightAdapter.RES_SUBJECT = 'setHeight';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVpZ2h0LWFkYXB0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL2FkYXB0ZXIvaGVpZ2h0LWFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsd0ZBQXNEO0FBRXREOztHQUVHO0FBQ0gsTUFBYSxhQUFhO0lBSXhCOzs7OztPQUtHO0lBQ0gsWUFBNkIsS0FBYTtRQUFiLFVBQUssR0FBTCxLQUFLLENBQVE7UUFSaEMsYUFBUSxHQUEwQixJQUFJLENBQUM7SUFRSixDQUFDO0lBRTlDOzs7Ozs7T0FNRztJQUNILE9BQU8sQ0FBQyxTQUFpQixFQUFFLFFBQWdCO1FBQ3pDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksa0NBQWMsQ0FDaEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQThCLEVBQUUsRUFBRTtZQUMvQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQztZQUM3QyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLGFBQWEsQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDdkYsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUNiLENBQUM7UUFDRixNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQy9DLElBQUksSUFBSSxFQUFFO1lBQ1IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDN0I7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVO1FBQ1IsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDM0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7U0FDdEI7SUFDSCxDQUFDO0lBRU8sUUFBUSxDQUFDLEVBQTBCLEVBQUUsSUFBWTtRQUN2RCxJQUFJLE9BQU8sR0FBa0IsSUFBSSxDQUFDO1FBQ2xDLE9BQU8sQ0FBQyxPQUE4QixFQUFFLFFBQXdCLEVBQVEsRUFBRTtZQUN4RSxJQUFJLE9BQU8sS0FBSyxJQUFJLEVBQUU7Z0JBQ3BCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQ3RCLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO2FBQzNEO1FBQ0gsQ0FBQyxDQUFDO0lBQ0osQ0FBQzs7QUFuREgsc0NBb0RDO0FBbkR5Qix5QkFBVyxHQUFHLFdBQVcsQ0FBQyJ9