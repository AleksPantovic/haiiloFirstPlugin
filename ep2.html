<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal View 1</title>
    <style id="pluginStyles"></style>
</head>
<body>
    <h1>Hello, <span id="userName">loading...</span>!</h1>
    <p>Welcome to your personal dashboard.</p>
    <p>ep2 site ep2 site</p>
    <div id="spotifyEmbed"></div>
    <script type="module">
        // Accessing manifest data and plugin context/configuration
        async function initializePlugin() {
            try {
                const pluginAdapter = await window.coyo.pluginAdapter();
                const manifestData = await pluginAdapter.getManifest(); // Fetching data from manifest
                const pluginContext = await pluginAdapter.getPluginContext();
                const pluginConfig = await pluginAdapter.getPluginConfig();

                // Set username from context
                document.getElementById('userName').textContent = pluginContext.userName || manifestData.userName;

                // Apply background color from pluginConfig or manifest
                const backgroundColor = pluginConfig.background || manifestData.defaultBackground;
                document.getElementById('pluginStyles').textContent = `body { background-color: ${backgroundColor}; }`;

                // Embed Spotify from configuration
                const spotifyLink = pluginConfig.spotifyLink || manifestData.defaultSpotifyLink;
                const spotifyLayout = pluginConfig.spotifyLayout || manifestData.defaultSpotifyLayout;
                const spotifyEmbedDiv = document.getElementById('spotifyEmbed');

                if (spotifyLink) {
                    let embedCode = '';
                    if (spotifyLayout === 'LARGE') {
                        embedCode = `<iframe style="border-radius:12px" src="https://open.spotify.com/embed/${spotifyLink.split('/').pop()}?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>`;
                    } else {
                        embedCode = `<iframe style="border-radius:12px" src="https://open.spotify.com/embed/${spotifyLink.split('/').pop()}?utm_source=generator" width="100%" height="152" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>`;
                    }
                    spotifyEmbedDiv.innerHTML = embedCode;
                }

            } catch (error) {
                console.error('Plugin initialization error:', error);
                document.getElementById('userName').textContent = 'Error loading data.';
            }
        }

        initializePlugin();
    </script>
</body>
</html>
